<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QR Code Generator</title>
<style>
body { font-family:'Segoe UI',sans-serif; margin:0; padding:0; background: linear-gradient(120deg, #6a11cb, #2575fc); }
.container { max-width:1000px; margin:20px auto; background:white; border-radius:15px; padding:20px; box-shadow:0 10px 30px rgba(0,0,0,0.2);}
header { text-align:center; padding:20px; background: linear-gradient(90deg, #ff512f, #dd2476); color:white; border-radius:10px; }
.content { display:flex; flex-wrap:wrap; gap:20px; margin-top:20px; }
.input-section, .output-section { flex:1; min-width:300px; padding:20px; border-radius:10px; }
.input-section { background:#f9f9ff; border-left:5px solid #ff512f; }
.output-section { background:#fff3f6; border-left:5px solid #2575fc; text-align:center; }
h2 { margin-bottom:15px; }
input, textarea { width:100%; padding:10px; margin-bottom:10px; border-radius:5px; border:1px solid #ccc; }
button { padding:10px 20px; border:none; border-radius:5px; cursor:pointer; margin-top:10px; font-weight:bold; }
#generate-btn { background:linear-gradient(90deg,#ff512f,#dd2476); color:white; }
#download-btn { background:linear-gradient(90deg,#6a11cb,#2575fc); color:white; }
#download-btn:disabled { background:#aaa; cursor:not-allowed; }
.qr-container { margin:20px 0; padding:20px; border:2px dashed #ccc; border-radius:10px; background:#fff0f5; }
.qr-container img { max-width:100%; border-radius:5px; }
.console { background:#1e1e2f; color:#f0f0f0; border-radius:5px; padding:10px; font-family:'Fira Code',monospace; max-height:150px; overflow-y:auto; }
.console-line { margin-bottom:5px; }
.info { color:#3498db; } .error { color:#e74c3c; } .success { color:#2ecc71; }
.status { padding:10px; border-radius:5px; margin-top:10px; }
.status.success { background:#d4edda; color:#155724; } .status.error { background:#f8d7da; color:#721c24; }
</style>
</head>
<body>
<div class="container">
<header><h1>Python QR Code Generator</h1></header>

<div class="content">
<div class="input-section">
<h2>QR Code Settings</h2>
<textarea id="qr-content" placeholder="Enter content to encode" rows="3">https://example.com</textarea>
<input type="text" id="qr-owner" placeholder="Owner Name (optional)">
<input type="text" id="qr-title" placeholder="Title (optional)">
<input type="file" id="qr-logo" accept="image/*">
<button id="generate-btn">Generate QR Code</button>
<button id="download-btn" disabled>Download QR Code</button>
<div class="status info" id="connection-status">Ready to connect to backend</div>
</div>

<div class="output-section">
<h2>Your QR Code</h2>
<div class="qr-container" id="qrcode"><p>QR Code will appear here</p></div>
<h2>Console</h2>
<div class="console" id="console"></div>
</div>
</div>
</div>

<script>
const contentEl=document.getElementById('qr-content');
const ownerEl=document.getElementById('qr-owner');
const titleEl=document.getElementById('qr-title');
const logoEl=document.getElementById('qr-logo');
const generateBtn=document.getElementById('generate-btn');
const downloadBtn=document.getElementById('download-btn');
const qrcodeDiv=document.getElementById('qrcode');
const consoleDiv=document.getElementById('console');
const connectionStatus=document.getElementById('connection-status');

function addConsole(msg,type='info'){
    const line=document.createElement('div');
    line.className=`console-line ${type}`;
    line.textContent=msg;
    consoleDiv.appendChild(line);
    consoleDiv.scrollTop=consoleDiv.scrollHeight;
}

generateBtn.addEventListener('click', async function(){
    const content=contentEl.value.trim();
    const owner=ownerEl.value.trim();
    const title=titleEl.value.trim();
    const logo=logoEl.files[0];

    if(!content){ addConsole('Error: content missing','error'); return; }

    const formData=new FormData();
    formData.append('content', content);
    formData.append('owner', owner);
    formData.append('title', title);
    if(logo) formData.append('logo', logo);

    qrcodeDiv.innerHTML='<p>Generating...</p>';
    generateBtn.disabled=true;

    try{
        const res=await fetch('http://localhost:5000/generate-qr',{method:'POST', body:formData});
        const data=await res.json();
        if(data.success){
            addConsole('QR code generated successfully','success');
            const img=document.createElement('img');
            img.src=data.image_url+'?t='+new Date().getTime();
            qrcodeDiv.innerHTML=''; qrcodeDiv.appendChild(img);
            downloadBtn.disabled=false;
            connectionStatus.className='status success';
            connectionStatus.textContent='Connected to backend';
        }else throw new Error(data.error||'Unknown error');
    }catch(err){
        addConsole('Error: '+err.message,'error');
        connectionStatus.className='status error';
        connectionStatus.textContent='Cannot connect to backend';
        qrcodeDiv.innerHTML='<p style="color:#e74c3c;">Error connecting to backend</p>';
    }finally{generateBtn.disabled=false;}
});

downloadBtn.addEventListener('click', function(){
    const img=qrcodeDiv.querySelector('img');
    if(!img) return;
    const link=document.createElement('a');
    link.href=img.src; link.download='qrcode.png';
    document.body.appendChild(link); link.click(); document.body.removeChild(link);
    addConsole('QR code downloaded','success');
});
</script>
</body>
</html>
